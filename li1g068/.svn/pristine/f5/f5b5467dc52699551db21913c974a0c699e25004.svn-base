module Main where

type Tab = [String]
type Pos = String

teste :: String -> IO()
teste f = do t <- readFile f
             let l = lines t
                 mapa = take (length l-2) l
                 n = length mapa
                 m = length (head (mapa))
                 pos_ini = head (take 1 (drop (length l-2) l))
                 solution = head (drop (length l-1) l)
             print (avancar mapa pos_ini)

esq :: Pos -> Pos
esq pos | (ori == "N") = unwords (coords ++ ["E"])
        | (ori == "E") = unwords (coords ++ ["S"])
        | (ori == "S") = unwords (coords ++ ["O"])
        | (ori == "O") = unwords (coords ++ ["N"])
           where posL = words pos
                 ori = posL !! 2
                 coords = (posL !! 0):(posL !! 1):[]

dir :: Pos -> Pos
dir pos | (ori == "N") = unwords (coords ++ ["O"])
        | (ori == "O") = unwords (coords ++ ["S"])
        | (ori == "S") = unwords (coords ++ ["E"])
        | (ori == "E") = unwords (coords ++ ["N"])
          where posL = words pos
                ori = posL !! 2
                coords = (posL !! 0):(posL !! 1):[]

avancar :: Tab -> Pos -> Pos
avancar tab pos | (getPos tab pos) == level = unwords nPos
                | (getPos tab pos) /= level = " "
                  where (level, x, y, ori) = getNext tab pos
                        nPos = [(show x),(show y),ori]

getPos :: Tab -> Pos -> Char
getPos mapa pos = ((nMap !! y) !! x)
                     where nMap = reverse mapa	
                           posL = words pos
                           x = (read (posL !! 0) :: Int)
                           y = (read (posL !! 1) :: Int)

getNext :: Tab -> Pos -> (Char, Int,Int, String)
getNext mapa pos | (ori == "N") && (y+1 < n)  = ((nMap !! ((y+1)) !! x), x, y+1, "N")
                 | (ori == "S") && (y-1 >= 0) = ((nMap !! ((y-1)) !! x), x, y-1, "S")
                 | (ori == "O") && (x+1 < m)  = ((nMap !! y) !! (x+1), x+1, y, "O")
                 | (ori == "E") && (x-1 >= 0) = ((nMap !! y) !! (x-1), x-1, y, "E")
                 | otherwise = (' ', -1, -1, " ")
                       where nMap = reverse mapa
                             posL = words pos
                             x = (read (posL !! 0) :: Int)
                             y = (read (posL !! 1) :: Int)
                             ori = posL !! 2
                             n = length mapa
                             m = length (head (mapa))